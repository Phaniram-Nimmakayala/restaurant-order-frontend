<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>View Orders</title>
  <style>
    :root{
  --choco-dark:#3e2723;
  --choco-mid:#5d4037;
  --choco-light:#8d6e63;
  --cream:#f5f0ea;
  --gold:#d7b56d;
}

/* Page background */
body{
  margin:0;
  min-height:100vh;
  background: white;
  font-family: "Segoe UI", Tahoma, sans-serif;
  color: white;
  padding:20px;
}

/* Card container (wrap your table with a div if needed) */
.orders-card{
  max-width:1200px;
  margin:auto;
  background:linear-gradient(145deg,#fff,#f3eee9);
  border-radius:14px;
  padding:20px;
  box-shadow:0 10px 35px rgba(0,0,0,.35);
  border:1px solid rgba(215,181,109,.4);
}

/* Title */
h2{
  margin:0 0 15px;
  text-align:center;
  color:var(--choco-dark);
  font-size:26px;
  letter-spacing:1px;
}
h2::after{
  content:"";
  width:120px;
  height:3px;
  background:linear-gradient(to right,var(--choco-dark),var(--gold),var(--choco-dark));
  display:block;
  margin:8px auto 0;
  border-radius:10px;
}

/* Table */
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  overflow:hidden;
  border-radius:12px;
  background:var(--cream);
  box-shadow:0 6px 20px rgba(0,0,0,.25);
}

/* Header */
th{
  padding:12px;
  text-align:left;
  background:linear-gradient(135deg,var(--choco-dark),var(--choco-mid));
  color:#fff;
  font-size:14px;
  text-transform:uppercase;
  letter-spacing:.5px;
  border-bottom:2px solid var(--gold);
}

/* Cells */
td{
  padding:10px;
  font-size:14px;
  color:#3b2b24;
  border-bottom:1px solid #e2d6cc;
}

/* Zebra rows */
tbody tr:nth-child(even){
  background:#f7f1eb;
}
tbody tr:nth-child(odd){
  background:#fff;
}

/* Hover effect */
tbody tr:hover{
  background:linear-gradient(90deg,#fff,#f1e4d6);
  transform:scale(1.002);
  transition:0.2s ease;
  box-shadow:0 2px 10px rgba(0,0,0,.15);
}

/* Highlight total column */
td:nth-child(6){
  font-weight:600;
  color:var(--choco-dark);
}

/* Delete button */
button{
  background:linear-gradient(135deg,#8b0000,#b71c1c);
  color:white;
  border:none;
  padding:6px 14px;
  cursor:pointer;
  border-radius:20px;
  font-size:13px;
  box-shadow:0 3px 8px rgba(0,0,0,.25);
  transition:0.2s ease;
}
button:hover{
  background:linear-gradient(135deg,#b71c1c,#d32f2f);
  transform:translateY(-1px);
  box-shadow:0 5px 12px rgba(0,0,0,.35);
}
button:active{
  transform:scale(.95);
}

/* Empty row */
.no-data{
  text-align:center;
  padding:20px;
  font-size:15px;
  color:var(--choco-mid);
}

/* Responsive */
@media(max-width:768px){
  table, thead, tbody, th, td, tr{
    display:block;
  }
  thead{
    display:none;
  }
  tr{
    margin-bottom:15px;
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,.15);
  }
  td{
    border:none;
    position:relative;
    padding-left:50%;
  }
  td::before{
    content:attr(data-label);
    position:absolute;
    left:10px;
    top:50%;
    transform:translateY(-50%);
    font-weight:600;
    color:var(--choco-dark);
  }
}

  </style>
</head>
<body>

<h2>All Orders</h2>

<table>
  <thead>
    <tr>
      <th>Date & Time</th>
      <th>Name</th>
      <th>Mobile</th>
      <th>Address</th>
      <th>Items</th>
      <th>Total</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="ordersTable"></tbody>
</table>

<script>
  const BACKEND_URL = "https://restaurant-order-app-1jjr.onrender.com";


  function formatDateTime(dateString) {
  // Convert "YYYY-MM-DD HH:MM:SS" → "YYYY-MM-DDTHH:MM:SSZ"
  const utcDate = new Date(dateString.replace(" ", "T") + "Z");

  return utcDate.toLocaleString("en-IN", {
    timeZone: "Asia/Kolkata",
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hour12: true
  });
}


function loadOrders() {
 fetch(`${BACKEND_URL}/orders`)

    .then(res => res.json())
    .then(data => {
      const table = document.getElementById("ordersTable");
      table.innerHTML = "";

      if (data.length === 0) {
        table.innerHTML = `<tr><td colspan="7">No orders found</td></tr>`;
        return;
      }

      data.forEach(order => {
        const items = JSON.parse(order.items)
          .map(i => `${i.name} × ${i.qty}`)
          .join("<br>");

        const row = `
          <tr>
            <td>${formatDateTime(order.created_at)}</td>

            <td>${order.customer_name}</td>
            <td>${order.mobile}</td>
            <td>${order.address}</td>
            <td>${items}</td>
            <td>₹${order.total}</td>
            <td>
              <button onclick="deleteOrder(${order.id})">Delete</button>
            </td>
          </tr>
        `;
        table.innerHTML += row;
      });
    });
}

function deleteOrder(id) {
  if (!confirm("Are you sure you want to delete this order?")) return;

fetch(`${BACKEND_URL}/delete-order/${id}`, {
    method: "DELETE"
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    loadOrders();   // Refresh table
  })
  .catch(err => {
    console.error(err);
    alert("Failed to delete order");
  });
}

// Load orders on page open
loadOrders();
</script>

</body>
</html>
